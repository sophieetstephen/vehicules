
{% extends "base.html" %}
{% block content %}
<h1 class="h4">Calendrier (semaine)</h1>
<p>Du {{ start.strftime("%d/%m/%Y") }} au {{ end.strftime("%d/%m/%Y") }}</p>
<table class="table table-bordered align-middle">
  <thead>
    <tr>
      <th>Véhicule</th>
      {% for i in range(7) %}
        <th>{{ (start + timedelta(days=i)).strftime("%a %d/%m") }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for v in vehicles %}
    <tr>
      <td><strong>{{ v.code }}</strong></td>
      {% for i in range(7) %}
        {% set day = (start + timedelta(days=i)) %}
        <td style="min-width:160px;">
          {% for r in reservations if r.vehicle_id==v.id and r.start_at.date() <= day.date() <= r.end_at.date() %}
            <div class="small border rounded p-1 mb-1 bg-success-subtle">
              {{ r.user.name }}<br>{{ r.start_at.strftime("%H:%M") }}–{{ r.end_at.strftime("%H:%M") }}<br>{{ r.purpose or "" }}
            </div>
          {% endfor %}
        </td>
      {% endfor %}
    </tr>
    {% endfor %}
  </tbody>
</table>
{% if user and user.role in ['chef','adjoint'] %}
  <a class="btn btn-outline-secondary" href="{{ url_for('export_pdf_week') }}">Exporter PDF (semaine)</a>
{% endif %}
{% endblock %}
